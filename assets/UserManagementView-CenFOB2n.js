import{e as L,r as u,o as R,g as i,i as t,l as E,F as C,k as V,P as A,j as r,G as m,I as b,z as M,E as F,t as p,n as O,u as H,h as d}from"./vendor-BHPTlv71.js";import{u as J,s as f}from"./index-BEMb2HgI.js";const K={class:"container mx-auto px-4 py-8"},Q={class:"bg-white rounded-lg shadow-lg p-6"},W={class:"flex justify-between items-center mb-6"},X={class:"flex space-x-3"},Y={key:0,class:"flex justify-center items-center py-12"},Z={key:1,class:"overflow-x-auto"},ee={class:"min-w-full table-auto"},te={class:"divide-y divide-gray-200"},oe={class:"px-4 py-3 text-sm text-gray-900"},se={class:"px-4 py-3 text-sm text-gray-900"},le={class:"px-4 py-3 text-sm"},ae={class:"px-4 py-3 text-sm text-gray-600"},re={class:"px-4 py-3 text-sm text-gray-600"},ne={class:"px-4 py-3 text-sm text-gray-600"},ie={class:"px-4 py-3 text-sm"},de=["onClick"],ue=["onClick"],me={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},pe={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},fe={class:"bg-gray-50 rounded-lg p-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be=["value"],xe={class:"bg-white border rounded-lg p-4"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce={class:"mt-4"},ye={class:"flex justify-end space-x-3 pt-4 border-t"},we=["disabled"],Ne={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ue={class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},he={class:"bg-gray-50 rounded-lg p-4"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"mt-4"},Ce=["value"],Ve={class:"bg-white border rounded-lg p-4"},Ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Me={class:"mt-4"},Fe={class:"flex justify-end space-x-3 pt-4 border-t"},_e=["disabled"],Se=L({__name:"UserManagementView",setup(Pe){const _=J(),h=u([]),v=u([]),c=u({}),k=u(!0),y=u(!1),w=u(!1),N=u(!1),U=u(!1),l=u({email:"",password:"",role:"user",assigned_team_id:"",firstName:"",lastName:"",position:"",phone:"",bio:""}),n=u({id:"",email:"",role:"user",assigned_team_id:"",created_at:""}),a=u({firstName:"",lastName:"",position:"",phone:"",bio:""});async function x(){try{k.value=!0;const{data:s,error:e}=await f.from("users").select("*").order("created_at",{ascending:!1});if(e)throw e;h.value=s||[],await P()}catch(s){console.error("Error loading users:",s),alert("Failed to load users")}finally{k.value=!1}}async function P(){try{for(const s of h.value)try{const{data:e,error:o}=await f.auth.admin.getUserById(s.id);!o&&e.user?.user_metadata&&(c.value[s.id]={firstName:e.user.user_metadata.firstName||"",lastName:e.user.user_metadata.lastName||"",position:e.user.user_metadata.position||"",phone:e.user.user_metadata.phone||"",bio:e.user.user_metadata.bio||""})}catch(e){console.warn(`Failed to load profile for user ${s.email}:`,e)}}catch(s){console.warn("Error loading user profiles:",s)}}async function D(){try{const{data:s,error:e}=await f.from("teams").select("id, name").order("name");if(e)throw e;v.value=s||[]}catch(s){console.error("Error loading teams:",s)}}async function $(){try{y.value=!0;const{data:s,error:e}=await f.auth.admin.createUser({email:l.value.email,password:l.value.password,email_confirm:!0,user_metadata:{firstName:l.value.firstName,lastName:l.value.lastName,position:l.value.position,phone:l.value.phone,bio:l.value.bio}});if(e)throw e;const{error:o}=await f.from("users").update({role:l.value.role,assigned_team_id:l.value.assigned_team_id||null}).eq("id",s.user.id);if(o)throw o;l.value={email:"",password:"",role:"user",assigned_team_id:"",firstName:"",lastName:"",position:"",phone:"",bio:""},N.value=!1,await x(),alert("User created successfully!")}catch(s){console.error("Error creating user:",s),alert(`Failed to create user: ${s.message}`)}finally{y.value=!1}}async function S(){try{w.value=!0;const{error:s}=await f.from("users").update({role:n.value.role,assigned_team_id:n.value.assigned_team_id||null}).eq("id",n.value.id);if(s)throw s;const{error:e}=await f.auth.admin.updateUserById(n.value.id,{user_metadata:{firstName:a.value.firstName,lastName:a.value.lastName,position:a.value.position,phone:a.value.phone,bio:a.value.bio}});e&&console.warn("Failed to update profile data:",e),c.value[n.value.id]={...a.value},U.value=!1,await x(),alert("User updated successfully!")}catch(s){console.error("Error updating user:",s),alert(`Failed to update user: ${s.message}`)}finally{w.value=!1}}async function T(s){n.value={...s};try{const{data:e,error:o}=await f.auth.admin.getUserById(s.id);if(o)console.warn("Could not load user profile data:",o),a.value={firstName:"",lastName:"",position:"",phone:"",bio:""};else{const g=e.user?.user_metadata||{};a.value={firstName:g.firstName||"",lastName:g.lastName||"",position:g.position||"",phone:g.phone||"",bio:g.bio||""}}}catch(e){console.error("Error loading user profile:",e),a.value={firstName:"",lastName:"",position:"",phone:"",bio:""}}U.value=!0}async function B(s){if(confirm(`Are you sure you want to delete user "${s.email}"?`))try{const{error:e}=await f.from("users").delete().eq("id",s.id);if(e)throw e;const{error:o}=await f.auth.admin.deleteUser(s.id);o&&console.warn("Failed to delete from auth, but user removed from database:",o),await x(),alert("User deleted successfully!")}catch(e){console.error("Error deleting user:",e),alert(`Failed to delete user: ${e.message}`)}}function I(s){switch(s){case"admin":return"bg-red-100 text-red-800";case"team":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}}function j(s){const e=v.value.find(o=>o.id===s);return e?e.name:"Unknown Team"}function z(s){const e=c.value[s];if(!e)return"";const o=e.firstName||"",g=e.lastName||"";return`${o} ${g}`.trim()}function q(s){return c.value[s]?.position||""}function G(s){return new Date(s).toLocaleDateString()}return R(async()=>{await Promise.all([x(),D()])}),(s,e)=>(d(),i("div",K,[t("div",Q,[t("div",W,[e[20]||(e[20]=t("h1",{class:"text-3xl font-bold text-gray-800"},"User Management",-1)),t("div",X,[t("button",{onClick:x,class:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"}," ðŸ”„ Refresh "),t("button",{onClick:e[0]||(e[0]=o=>N.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"}," Add New User ")])]),k.value?(d(),i("div",Y,[...e[21]||(e[21]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("span",{class:"ml-2 text-gray-600"},"Loading users...",-1)])])):(d(),i("div",Z,[t("table",ee,[e[22]||(e[22]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Email"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Name"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Role"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Position"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Assigned Team"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Created"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions")])],-1)),t("tbody",te,[(d(!0),i(C,null,V(h.value,o=>(d(),i("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",oe,p(o.email),1),t("td",se,p(z(o.id)||"-"),1),t("td",le,[t("span",{class:O(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",I(o.role)])},p(o.role),3)]),t("td",ae,p(q(o.id)||"-"),1),t("td",re,p(o.assigned_team_id?j(o.assigned_team_id):"-"),1),t("td",ne,p(G(o.created_at)),1),t("td",ie,[t("button",{onClick:g=>T(o),class:"text-blue-600 hover:text-blue-800 mr-3"}," Edit ",8,de),o.id!==H(_).user?.id?(d(),i("button",{key:0,onClick:g=>B(o),class:"text-red-600 hover:text-red-800"}," Delete ",8,ue)):E("",!0)])]))),128))])])]))]),N.value?(d(),i("div",me,[t("div",pe,[e[38]||(e[38]=t("h2",{class:"text-xl font-bold mb-4"},"Add New User",-1)),t("form",{onSubmit:A($,["prevent"]),class:"space-y-6"},[t("div",fe,[e[30]||(e[30]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Account Information",-1)),t("div",ge,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.email=o),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"user@example.com"},null,512),[[m,l.value.email]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Password",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.password=o),type:"password",required:"",minlength:"6",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Minimum 6 characters"},null,512),[[m,l.value.password]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Role",-1)),r(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.role=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[25]||(e[25]=[t("option",{value:"user"},"User",-1),t("option",{value:"team"},"Team",-1),t("option",{value:"admin"},"Admin",-1)])],512),[[b,l.value.role]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[M(" Assign to Team "),t("span",{class:"text-xs text-gray-500"},"(Optional for all roles)")],-1)),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.assigned_team_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[27]||(e[27]=t("option",{value:""},"No team assigned",-1)),(d(!0),i(C,null,V(v.value,o=>(d(),i("option",{key:o.id,value:o.id},p(o.name),9,be))),128))],512),[[b,l.value.assigned_team_id]]),e[29]||(e[29]=t("p",{class:"text-xs text-gray-500 mt-1"}," Users can be assigned to teams regardless of their role for organizational purposes. ",-1))])])]),t("div",xe,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Personal Information",-1)),t("div",ve,[t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"First Name",-1)),r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.firstName=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter first name"},null,512),[[m,l.value.firstName]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Last Name",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.lastName=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter last name"},null,512),[[m,l.value.lastName]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Position",-1)),r(t("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.position=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[33]||(e[33]=[F('<option value="">Select position</option><option value="Goalkeeper">Goalkeeper</option><option value="Defender">Defender</option><option value="Midfielder">Midfielder</option><option value="Forward">Forward</option><option value="Coach">Coach</option><option value="Assistant Coach">Assistant Coach</option><option value="Manager">Manager</option>',8)])],512),[[b,l.value.position]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Phone Number",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.phone=o),type:"tel",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number"},null,512),[[m,l.value.phone]])])]),t("div",ce,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bio / Description",-1)),r(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.bio=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter bio or description..."},null,512),[[m,l.value.bio]])])]),t("div",ye,[t("button",{type:"button",onClick:e[10]||(e[10]=o=>N.value=!1),class:"px-6 py-2 text-gray-600 hover:text-gray-800"}," Cancel "),t("button",{type:"submit",disabled:y.value,class:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50"},p(y.value?"Creating...":"Create User"),9,we)])],32)])])):E("",!0),U.value?(d(),i("div",Ne,[t("div",Ue,[e[53]||(e[53]=t("h2",{class:"text-xl font-bold mb-4"},"Edit User",-1)),t("form",{onSubmit:A(S,["prevent"]),class:"space-y-6"},[t("div",he,[e[45]||(e[45]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Account Information",-1)),t("div",ke,[t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>n.value.email=o),type:"email",readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"},null,512),[[m,n.value.email]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Role",-1)),r(t("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>n.value.role=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[40]||(e[40]=[t("option",{value:"user"},"User",-1),t("option",{value:"team"},"Team",-1),t("option",{value:"admin"},"Admin",-1)])],512),[[b,n.value.role]])])]),t("div",Ee,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[M(" Assign to Team "),t("span",{class:"text-xs text-gray-500"},"(Optional for all roles)")],-1)),r(t("select",{"onUpdate:modelValue":e[13]||(e[13]=o=>n.value.assigned_team_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[42]||(e[42]=t("option",{value:""},"No team assigned",-1)),(d(!0),i(C,null,V(v.value,o=>(d(),i("option",{key:o.id,value:o.id},p(o.name),9,Ce))),128))],512),[[b,n.value.assigned_team_id]]),e[44]||(e[44]=t("p",{class:"text-xs text-gray-500 mt-1"}," Users can be assigned to teams regardless of their role for organizational purposes. ",-1))])]),t("div",Ve,[e[52]||(e[52]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Personal Information",-1)),t("div",Ae,[t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"First Name",-1)),r(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>a.value.firstName=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter first name"},null,512),[[m,a.value.firstName]])]),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Last Name",-1)),r(t("input",{"onUpdate:modelValue":e[15]||(e[15]=o=>a.value.lastName=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter last name"},null,512),[[m,a.value.lastName]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Position",-1)),r(t("select",{"onUpdate:modelValue":e[16]||(e[16]=o=>a.value.position=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[48]||(e[48]=[F('<option value="">Select position</option><option value="Goalkeeper">Goalkeeper</option><option value="Defender">Defender</option><option value="Midfielder">Midfielder</option><option value="Forward">Forward</option><option value="Coach">Coach</option><option value="Assistant Coach">Assistant Coach</option><option value="Manager">Manager</option>',8)])],512),[[b,a.value.position]])]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Phone Number",-1)),r(t("input",{"onUpdate:modelValue":e[17]||(e[17]=o=>a.value.phone=o),type:"tel",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number"},null,512),[[m,a.value.phone]])])]),t("div",Me,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bio / Description",-1)),r(t("textarea",{"onUpdate:modelValue":e[18]||(e[18]=o=>a.value.bio=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter bio or description..."},null,512),[[m,a.value.bio]])])]),t("div",Fe,[t("button",{type:"button",onClick:e[19]||(e[19]=o=>U.value=!1),class:"px-6 py-2 text-gray-600 hover:text-gray-800"}," Cancel "),t("button",{type:"submit",disabled:w.value,class:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50"},p(w.value?"Updating...":"Update User"),9,_e)])],32)])])):E("",!0)]))}});export{Se as default};
