import{e as At,B as $t,r as b,a as j,o as Mt,f as Pt,g as c,i as s,l as v,t as n,x as Pe,y as Ee,s as Et,z as B,F as M,k as q,n as w,P as He,j as fe,I as Qe,E as qt,q as Ft,Q as Dt,v as Ke,h as d}from"./vendor-BHPTlv71.js";import{s as F,_ as It}from"./index-BEMb2HgI.js";import{S as U}from"./soundManager-CcbvAGRv.js";import{g as C,a as Rt,c as G,b as Ut}from"./timeline-C-9ia41o.js";const jt={class:"min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900"},Ot={class:"container mx-auto px-4 py-8"},zt={key:0,class:"text-center py-16"},Nt={class:"text-4xl font-bold text-white animate-pulse"},Lt={key:1,class:"text-center py-16"},Gt={class:"text-4xl font-bold text-white mb-4"},Vt={key:2},Ht={class:"flex justify-between items-center mb-8"},Qt={class:"text-4xl font-bold text-white mb-2"},Kt={class:"text-blue-100"},Yt={class:"flex gap-2"},Wt={key:0,class:"text-center py-16"},Jt={class:"text-3xl font-bold text-white mb-4"},Xt={class:"text-blue-200 mb-8"},Zt=["disabled"],ea={key:0,class:"mr-2"},ta={key:1,class:"mr-2"},aa={key:2,class:"text-xs block"},sa={key:1,class:"grid lg:grid-cols-3 gap-8"},oa={class:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20"},la={class:"text-2xl font-bold text-blue-300 mb-6 text-center"},na={class:"text-center mb-6"},ia={class:"text-6xl font-bold text-white mb-4"},ra={class:"flex justify-center space-x-2"},ca={class:"text-center mb-6"},da={class:"text-4xl font-bold text-yellow-300 mb-3"},ua={class:"flex justify-center space-x-2"},ma={class:"mb-6"},va={class:"text-lg font-semibold text-white mb-3"},ba={key:0,class:"space-y-2"},ga={key:1,class:"text-sm text-blue-200 italic text-center py-4"},pa={class:"text-xs text-blue-300 mt-2 text-center"},fa={key:0,class:"mb-6"},ha={class:"text-lg font-semibold text-white mb-3"},_a={class:"space-y-2"},xa={class:"flex justify-between items-center"},ya={class:"flex-1"},wa={class:"text-sm font-bold flex items-center"},ka={class:"text-lg mr-2"},Ca={key:0,class:"ml-2 text-xs bg-green-500 px-2 py-1 rounded-full animate-pulse"},Ba={key:1,class:"ml-2 text-xs bg-blue-500 px-2 py-1 rounded-full"},Ta={class:"text-xs text-blue-200 mt-1"},Sa=["onClick"],Aa=["onClick"],$a={key:2,class:"text-green-400 text-xs ml-2 animate-bounce"},Ma={class:"space-y-2 max-h-64 overflow-y-auto"},Pa={class:"flex justify-between items-center mb-2"},Ea={class:"text-white font-medium"},qa={class:"text-xs text-blue-300"},Fa={key:0,class:"mb-2"},Da={class:"grid grid-cols-3 gap-1"},Ia=["onClick"],Ra=["onClick"],Ua=["onClick"],ja={class:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20"},Oa={class:"text-center mb-8"},za={class:"mb-3"},Na={class:"text-2xl font-bold text-blue-200 mb-2"},La={key:0,class:"text-lg text-white/80"},Ga={class:"text-6xl font-mono font-bold text-yellow-400 mb-2"},Va={class:"grid grid-cols-2 gap-3 mb-6"},Ha=["disabled"],Qa={key:0},Ka={key:1},Ya=["disabled"],Wa={key:0},Ja={key:1},Xa=["disabled"],Za={key:0},es={key:1},ts=["disabled"],as={key:0},ss={key:1},os={key:5,class:"col-span-2 text-center text-green-400 text-sm"},ls={class:"space-y-4"},ns={key:0,class:"mb-3 p-3 bg-purple-600/80 rounded-lg border border-purple-400"},is={class:"text-center"},rs={class:"text-2xl mb-1"},cs={class:"text-sm font-semibold text-purple-100"},ds={key:0,class:"text-xs text-purple-200 animate-pulse"},us={key:1,class:"text-xs text-purple-200 animate-pulse"},ms={key:1,class:"mb-3 p-3 bg-orange-600/80 rounded-lg border border-orange-400"},vs={class:"text-center"},bs={class:"text-lg font-bold text-orange-100"},gs={key:2,class:"space-y-2"},ps={class:"grid grid-cols-1 gap-2"},fs=["onClick"],hs={class:"text-xl"},_s={class:"text-sm font-medium text-purple-100"},xs={class:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20"},ys={class:"text-2xl font-bold text-red-300 mb-6 text-center"},ws={class:"text-center mb-6"},ks={class:"text-6xl font-bold text-white mb-4"},Cs={class:"flex justify-center space-x-2"},Bs={class:"text-center mb-6"},Ts={class:"text-4xl font-bold text-yellow-300 mb-3"},Ss={class:"flex justify-center space-x-2"},As={class:"mb-6"},$s={key:0,class:"space-y-2"},Ms={key:1,class:"text-sm text-red-200 italic text-center py-4"},Ps={class:"text-xs text-red-300 mt-2 text-center"},Es={key:0,class:"mb-6"},qs={class:"space-y-2"},Fs={class:"flex justify-between items-center"},Ds={class:"flex-1"},Is={class:"text-sm font-bold flex items-center"},Rs={class:"text-lg mr-2"},Us={key:0,class:"ml-2 text-xs bg-green-500 px-2 py-1 rounded-full animate-pulse"},js={key:1,class:"ml-2 text-xs bg-red-500 px-2 py-1 rounded-full"},Os={class:"text-xs text-red-200 mt-1"},zs=["onClick"],Ns=["onClick"],Ls={key:2,class:"text-green-400 text-xs ml-2 animate-bounce"},Gs={class:"space-y-2 max-h-64 overflow-y-auto"},Vs={class:"flex justify-between items-center mb-2"},Hs={class:"text-white font-medium"},Qs={class:"text-xs text-red-300"},Ks={key:0,class:"mb-2"},Ys={class:"grid grid-cols-3 gap-1"},Ws=["onClick"],Js=["onClick"],Xs=["onClick"],Zs={class:"mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20"},eo={class:"flex justify-center space-x-4 flex-wrap gap-2"},to=["disabled"],ao={class:"mb-6 text-center"},so={class:"text-lg lg:text-xl font-bold text-yellow-400"},oo={class:"text-sm text-gray-400 mt-2"},lo={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},no={class:"text-xl lg:text-2xl font-bold text-blue-300 mb-4"},io={key:0,class:"h-24 lg:h-32 bg-black/30 rounded-lg mb-4 flex items-center justify-center relative overflow-hidden border-2 border-blue-400"},ro={key:1,class:"space-y-2"},co={class:"text-base lg:text-lg font-bold"},uo={class:"text-sm text-blue-200"},mo={class:"text-xl lg:text-2xl font-bold text-red-300 mb-4"},vo={key:0,class:"h-24 lg:h-32 bg-black/30 rounded-lg mb-4 flex items-center justify-center relative overflow-hidden border-2 border-red-400"},bo={key:1,class:"space-y-2"},go={class:"text-base lg:text-lg font-bold"},po={class:"text-sm text-red-200"},fo={class:"mb-6"},ho={class:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3"},_o={class:"text-xl lg:text-2xl mb-1 lg:mb-2"},xo={class:"text-xs lg:text-sm font-bold text-white"},yo={class:"text-xs text-gray-300 mt-1 line-clamp-2"},wo={class:"flex flex-wrap justify-center gap-2 lg:gap-4"},ko=["disabled"],Co={class:"relative w-full max-w-5xl max-h-[90vh] overflow-hidden bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 rounded-2xl shadow-2xl border border-blue-500/30"},Bo={class:"flex items-center justify-between p-6 border-b border-blue-500/30 bg-gradient-to-r from-blue-600/20 to-purple-600/20"},To={class:"p-6 overflow-y-auto max-h-[calc(90vh-88px)]"},So={class:"grid grid-cols-2 gap-6 mb-6"},Ao={key:0,class:"bg-gradient-to-br from-blue-800/40 to-blue-900/40 rounded-xl p-6 border border-blue-500/30"},$o={class:"text-2xl font-bold text-white mb-4"},Mo={class:"grid grid-cols-2 gap-4"},Po={class:"bg-blue-900/50 rounded-lg p-3 text-center"},Eo={class:"text-4xl font-bold text-blue-300"},qo={class:"bg-blue-900/50 rounded-lg p-3 text-center"},Fo={class:"text-4xl font-bold text-purple-300"},Do={class:"bg-blue-900/50 rounded-lg p-3 text-center"},Io={class:"text-4xl font-bold text-green-300"},Ro={class:"bg-blue-900/50 rounded-lg p-3 text-center"},Uo={class:"text-4xl font-bold text-yellow-300"},jo={key:1,class:"bg-gradient-to-br from-purple-800/40 to-purple-900/40 rounded-xl p-6 border border-purple-500/30"},Oo={class:"text-2xl font-bold text-white mb-4"},zo={class:"grid grid-cols-2 gap-4"},No={class:"bg-purple-900/50 rounded-lg p-3 text-center"},Lo={class:"text-4xl font-bold text-purple-300"},Go={class:"bg-purple-900/50 rounded-lg p-3 text-center"},Vo={class:"text-4xl font-bold text-blue-300"},Ho={class:"bg-purple-900/50 rounded-lg p-3 text-center"},Qo={class:"text-4xl font-bold text-green-300"},Ko={class:"bg-purple-900/50 rounded-lg p-3 text-center"},Yo={class:"text-4xl font-bold text-yellow-300"},Wo={class:"flex gap-4 mb-6 p-4 bg-slate-800/50 rounded-xl border border-slate-700"},Jo={class:"flex-1"},Xo={class:"flex-1"},Zo={value:"a"},el={value:"b"},tl={class:"bg-slate-800/50 rounded-xl border border-slate-700 p-4"},al={class:"text-xl font-bold text-white mb-4 flex items-center gap-2"},sl={class:"text-sm text-slate-400"},ol={key:0,class:"text-center py-8 text-slate-400"},ll={key:1,class:"space-y-3 max-h-96 overflow-y-auto"},nl={class:"text-2xl"},il={class:"flex-1"},rl={class:"text-white font-semibold"},cl={class:"text-sm text-slate-300 mt-1"},dl={key:0},ul={key:1},ml={key:2,class:"ml-2"},vl={key:0,class:"text-xs text-slate-400 mt-1"},bl={key:0},gl={key:1,class:"text-xs text-slate-400 mt-1"},pl={key:2,class:"text-xs text-slate-400 mt-1"},fl={key:3,class:"text-xs text-slate-400 mt-1"},hl={key:4,class:"text-xs text-slate-400 mt-1"},_l={class:"text-xs text-slate-400 whitespace-nowrap"},xl=At({__name:"MatchControlView",props:{id:{}},setup(Ye){const ce=Ye,qe=Ft(),{t:yl}=$t(),o=b(null),he=b({}),_e=b(!0),Z=b(!1),Q=b(!1),O=b(!1),K=b(null),Y=b(null);b(!1);const f=b({play:!1,pause:!1,finish:!1,spinners:!1}),W=b({});function z(e,t){f.value[e]=t,W.value[e]&&(clearTimeout(W.value[e]),delete W.value[e]),t===!0&&(W.value[e]=setTimeout(()=>{console.warn(`‚ö†Ô∏è Button state '${e}' was stuck - auto-resetting`),f.value[e]=!1,delete W.value[e]},15e3))}const ee=b({}),te=b({}),T=b("quarter"),S=b(1),A=b(0),xe=b(0),ae=b(!1),de=b("all"),ue=b("all"),V=b(!1),h=b(!1),y=b(null),se=b(0),x=b({teamA:[],teamB:[]}),m=b("ready"),Fe=b(!1),k=b([]),De=b([]),H=b({}),D=b(null),oe=[];let ye=!1;async function We(){try{const[e,t]=await Promise.all([F.from("boosters").select("*").order("title"),F.from("maddies").select("*").order("title")]);e.error?console.error("Error loading boosters:",e.error):k.value=e.data.map(l=>({id:l.id,name:l.title,description:l.description,icon:l.icon||"‚ö°",sound_file:l.sound_file,duration:l.has_countdown?l.duration/60:void 0})),t.error?console.error("Error loading maddies:",t.error):De.value=t.data}catch(e){console.error("Error loading boosters and maddies:",e)}}const Je=e=>{const t=e%10,l=e%100;return t===1&&l!==11?"st":t===2&&l!==12?"nd":t===3&&l!==13?"rd":"th"},I=j(()=>o.value?he.value[o.value.team_a]:null),R=j(()=>o.value?he.value[o.value.team_b]:null),P=j(()=>o.value?{quarters_count:o.value.quarters_count||4,quarter_duration_minutes:o.value.quarter_duration_minutes||15,break_duration_minutes:o.value.break_duration_minutes||2,halftime_duration_minutes:o.value.halftime_duration_minutes||10}:null),Ie=j(()=>P.value?.quarters_count===2),Xe=j(()=>P.value?.quarters_count===1),Ze=j(()=>{if(!P.value)return"Game";switch(T.value){case"quarter":return Xe.value?"Match":Ie.value?`${S.value}${S.value===1?"st":"nd"} Half`:`${S.value}${Je(S.value)} Quarter`;case"break":return Ie.value?"Halftime":"Break";case"halftime":return"Halftime";case"finished":return"Game Over";default:return"Game"}}),$=(e,t)=>{if(!o.value?.cards?.player_penalties)return null;const l=`${t.number}_${t.name.replace(/\s+/g,"_")}`,a=`team_${e}`,i=o.value.cards.player_penalties[a]?.[l];if(!i)return null;if(i.expires_at==="never")return{...i,time_remaining:"Game"};const r=new Date,u=new Date(i.expires_at),p=Math.max(0,Math.floor((u.getTime()-r.getTime())/1e3));return p>0?{...i,time_remaining:p}:null},we=e=>{if(e==="Game")return"GAME";if(typeof e!="number")return"";const t=Math.floor(e/60),l=e%60;return`${t}:${l.toString().padStart(2,"0")}`},Re=()=>{const e=se.value;return e!==void 0&&k.value[e]?k.value[e].icon:"üé∞"},et=()=>{switch(m.value){case"ready":return"Ready to select boosters";case"team-a-first":return`${I.value?.name||"Team A"} - First Booster`;case"team-a-second":return`${I.value?.name||"Team A"} - Second Booster`;case"team-b-first":return`${R.value?.name||"Team B"} - First Booster`;case"team-b-second":return`${R.value?.name||"Team B"} - Second Booster`;case"complete":return"All boosters selected!";default:return""}},tt=()=>{switch(m.value){case"ready":return"üé∞ Start Booster Selection";case"team-a-first":case"team-a-second":case"team-b-first":case"team-b-second":return"üé∞ Spin for Next Booster";default:return"üé∞ Spin"}},me=e=>{if(!o.value?.cards?.player_penalties)return[];const t=`team_${e}`,l=[],a=o.value.cards.player_penalties[t]||{},i=o.value.cards.player_info?.[t]||{};return Object.keys(a).forEach(r=>{const u=a[r],p=i[r];if(!u||!p)return;let _="GAME";if(u.expires_at!=="never"){const E=new Date,L=new Date(u.expires_at),X=Math.max(0,Math.floor((L.getTime()-E.getTime())/1e3));if(X>0)_=we(X);else return}l.push({playerId:r,playerNumber:p.number,playerName:p.name,type:u.type,timeRemaining:_})}),l},ke=e=>{const t=Math.floor(e/60),l=e%60;return`${t.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},le=j(()=>{if(!o.value||!I.value)return null;const e=o.value.timeline||[];return{goals:C(e,"goal").filter(t=>t.team==="a").length,penaltyCorners:C(e,"penalty_corner").filter(t=>t.team==="a").length,boosters:C(e,"booster_activated").filter(t=>t.team==="a").length,maddies:C(e,"maddie_activated").length,yellowCards:C(e,"card_issued").filter(t=>t.team==="a"&&t.details.card_type==="yellow").length,greenCards:C(e,"card_issued").filter(t=>t.team==="a"&&t.details.card_type==="green").length,redCards:C(e,"card_issued").filter(t=>t.team==="a"&&t.details.card_type==="red").length}}),ne=j(()=>{if(!o.value||!R.value)return null;const e=o.value.timeline||[];return{goals:C(e,"goal").filter(t=>t.team==="b").length,penaltyCorners:C(e,"penalty_corner").filter(t=>t.team==="b").length,boosters:C(e,"booster_activated").filter(t=>t.team==="b").length,maddies:C(e,"maddie_activated").length,yellowCards:C(e,"card_issued").filter(t=>t.team==="b"&&t.details.card_type==="yellow").length,greenCards:C(e,"card_issued").filter(t=>t.team==="b"&&t.details.card_type==="green").length,redCards:C(e,"card_issued").filter(t=>t.team==="b"&&t.details.card_type==="red").length}}),Ce=j(()=>{if(!o.value)return[];let e=o.value.timeline||[];return de.value!=="all"&&(e=C(e,de.value)),ue.value!=="all"&&(e=Rt(e,ue.value)),e});async function N(e){if(o.value)try{const t=o.value.timeline||[],l=Ut(t,e);console.log("üìù Recording timeline event:",e.type,e),await g({timeline:l})}catch(t){console.error("‚ùå Failed to record timeline event:",t)}}async function at(){try{console.log("ÔøΩ Loading match with id:",ce.id);const{data:e,error:t}=await F.from("matches").select("*").eq("id",ce.id).single();if(t){console.error("Error loading match:",t),qe.push("/admin");return}o.value=e,console.log("ÔøΩ Match loaded:",{status:e.status,data:e}),console.log("üö® MATCH CONTROL - Now watching match:",e.id);const l=e.boosters?.teamA?.length>0||e.boosters?.teamB?.length>0,a=Object.keys(e.cards||{}).length>0,i=e.score_a>0||e.score_b>0,r=e.time_left!==ve(),p=e.status!=="pending"||l||a||i||r;O.value=p,console.log("ÔøΩ Match initialization status:",{initialized:O.value,hasBeenModified:p}),Be()}catch(e){console.error("Error loading match:",e),qe.push("/admin")}}function Be(){if(!o.value||!P.value)return;const e=P.value,t=e.quarter_duration_minutes*60,l=e.break_duration_minutes*60,a=e.halftime_duration_minutes*60,i=e.quarters_count*t;let r=0;e.quarters_count===1?r=0:e.quarters_count===2?r=a:e.quarters_count>2&&(r=(e.quarters_count-1-1)*l+a),xe.value=i+r,st()}function st(){if(!o.value||!P.value)return;const e=xe.value-o.value.time_left,t=P.value,l=t.quarter_duration_minutes*60,a=t.break_duration_minutes*60,i=t.halftime_duration_minutes*60;let r=0;for(let u=1;u<=t.quarters_count;u++){if(e<=r+l){T.value="quarter",S.value=u,A.value=l-(e-r);return}if(r+=l,u<t.quarters_count){const p=t.quarters_count===2||u===Math.floor(t.quarters_count/2)&&t.quarters_count>2,_=p?i:a;if(e<=r+_){T.value=p?"halftime":"break",S.value=u,A.value=_-(e-r);return}r+=_}}T.value="finished",S.value=t.quarters_count,A.value=0}function ve(){if(!P.value)return 1800;const e=P.value,t=e.quarter_duration_minutes*60,l=e.break_duration_minutes*60,a=e.halftime_duration_minutes*60,i=e.quarters_count*t;let r=0;return e.quarters_count===1?r=0:e.quarters_count===2?r=a:e.quarters_count>2&&(r=(e.quarters_count-1-1)*l+a),i+r}function ot(){if(P.value&&A.value<=0){const e=P.value;if(T.value==="quarter")if(S.value<e.quarters_count){const t=e.quarters_count===2||S.value===Math.floor(e.quarters_count/2)&&e.quarters_count>2;T.value=t?"halftime":"break",A.value=t?e.halftime_duration_minutes*60:e.break_duration_minutes*60}else T.value="finished",A.value=0,Ae();else(T.value==="break"||T.value==="halftime")&&(S.value++,T.value="quarter",A.value=e.quarter_duration_minutes*60);console.log("ÔøΩ Phase transition:",{phase:T.value,period:S.value,timeLeft:A.value})}}async function lt(){try{const{data:e,error:t}=await F.from("teams").select("*");if(t)throw console.error("Error loading teams:",t),t;const l={};e?.forEach(a=>{l[a.id]=a}),he.value=l}catch(e){throw console.error("‚ùå Critical error loading teams:",e),e}}async function nt(){if(!(ye||oe.length===0)){for(ye=!0,console.log("üìù Processing update queue with",oe.length,"items");oe.length>0;){const e=oe.shift();if(e)try{console.log("üìù Processing queued update..."),await e(),console.log("‚úÖ Queued update completed successfully")}catch(t){console.error("‚ùå Error processing queued update:",t)}}ye=!1,console.log("üìù Update queue processing completed")}}function it(e){oe.push(e),nt()}async function g(e){return console.log("üîß updateMatch function started"),new Promise((t,l)=>{it(async()=>{const i=setTimeout(()=>{console.error("‚ùå updateMatch timeout - operation took too long"),l(new Error("Update operation timed out after 10 seconds"))},1e4);try{console.log("üìù Processing queued update with:",e),console.log("üìù Match ID:",ce.id),console.log("üìù Current match state before update:",{status:o.value?.status,score_a:o.value?.score_a,score_b:o.value?.score_b,boosters:o.value?.boosters?"present":"absent"}),!e.boosters&&o.value?.boosters&&(o.value.boosters.teamA?.length>0||o.value.boosters.teamB?.length>0)&&(console.log("üîí Preserving existing boosters during non-booster update"),e.boosters=o.value.boosters);const r=await F.from("matches").update(e).eq("id",ce.id);if(console.log("üìù Supabase update result:",r),r.error){console.error("‚ùå Error updating match:",r.error),clearTimeout(i),l(r.error);return}console.log("‚úÖ Match updated successfully in database"),o.value&&(Object.assign(o.value,e),console.log("‚úÖ Local state updated:",{status:o.value.status,updateType:Object.keys(e).join(", ")})),await new Promise(u=>setTimeout(u,100)),clearTimeout(i),t({success:!0})}catch(r){console.error("‚ùå Exception updating match:",r),clearTimeout(i),l(r)}})})}function Te(){K.value&&clearInterval(K.value),K.value=setInterval(async()=>{if(o.value&&o.value.status==="active"&&o.value.time_left>0){const e=o.value.time_left-1;o.value.time_left=e,A.value>0&&A.value--,ot(),(e%5===0||e===0)&&(await g({time_left:e}),e===0&&await Ae())}},1e3)}function Se(){Y.value&&clearInterval(Y.value),Y.value=setInterval(async()=>{if(!o.value?.cards?.player_penalties)return;const e=new Date;let t=!1;const l={...o.value.cards},a={...l.player_penalties};Object.keys(a).forEach(i=>{Object.keys(a[i]||{}).forEach(r=>{const u=a[i][r];if(u&&u.expires_at!=="never"){const p=new Date(u.expires_at);e>=p&&(delete a[i][r],t=!0)}})}),t&&(l.player_penalties=a,await g({cards:l}))},1e3)}function ie(){K.value&&(clearInterval(K.value),K.value=null)}function re(){Y.value&&(clearInterval(Y.value),Y.value=null)}async function rt(){if(!f.value.play){z("play",!0);try{console.log("‚ñ∂Ô∏è Starting match..."),await g({status:"active"});const e=G(o.value?.score_a===0&&o.value?.score_b===0?"match_started":"match_resumed",null,{status:"active"},o.value?.time_left||0);await N(e),Te(),Se(),console.log("‚úÖ Match started successfully")}catch(e){console.error("‚ùå Failed to start match:",e),alert("Failed to start match. Please try again.")}finally{z("play",!1)}}}async function ct(){if(!f.value.pause){z("pause",!0);try{console.log("‚è∏Ô∏è Pausing match..."),await g({status:"paused"});const e=G("match_paused",null,{status:"paused"},o.value?.time_left||0);await N(e),ie(),re(),console.log("‚úÖ Match paused successfully")}catch(e){console.error("‚ùå Failed to pause match:",e),alert("Failed to pause match. Please try again.")}finally{z("pause",!1)}}}async function Ae(){if(!f.value.finish){z("finish",!0);try{console.log("üèÅ Finishing match..."),await g({status:"finished"});const e=G("match_finished",null,{status:"finished"},o.value?.time_left||0);await N(e),ie(),re(),console.log("‚úÖ Match finished successfully")}catch(e){console.error("‚ùå Failed to finish match:",e),alert("Failed to finish match. Please try again.")}finally{z("finish",!1)}}}async function be(e,t){const l=`score_${e}`;console.log(`üî¢ updateScore called: team=${e}, increment=${t}`),ee.value[l]&&clearTimeout(ee.value[l]);const a=e==="a"?o.value?.score_a||0:o.value?.score_b||0,i=Math.max(0,a+t);console.log(`üî¢ Score change: ${a} -> ${i} for team ${e.toUpperCase()}`),o.value&&(e==="a"?o.value.score_a=i:o.value.score_b=i,console.log(`üî¢ Local UI updated immediately: ${e}=${i}`)),ee.value[l]=setTimeout(async()=>{try{const r=e==="a"?{score_a:i}:{score_b:i};if(console.log("üî¢ Sending score update to database:",r),await g(r),t>0){const u=G("goal",e,{score_a:e==="a"?i:o.value?.score_a||0,score_b:e==="b"?i:o.value?.score_b||0,pc:!1},o.value?.time_left||0);await N(u)}console.log(`‚úÖ Score updated for team ${e.toUpperCase()}:`,r)}catch(r){console.error(`‚ùå Failed to update score for team ${e}:`,r),o.value&&(e==="a"?o.value.score_a=a:o.value.score_b=a)}delete ee.value[l]},300)}async function ge(e,t){const l=`pc_${e}`;console.log(`üèí updatePC called: team=${e}, increment=${t}`),te.value[l]&&clearTimeout(te.value[l]);const a=e==="a"?o.value?.pc_a||0:o.value?.pc_b||0,i=Math.max(0,a+t);console.log(`üèí PC change: ${a} -> ${i} for team ${e.toUpperCase()}`),o.value&&(e==="a"?o.value.pc_a=i:o.value.pc_b=i,console.log(`üèí Local UI updated immediately: PC ${e}=${i}`)),te.value[l]=setTimeout(async()=>{try{const r=e==="a"?{pc_a:i}:{pc_b:i};if(console.log("üèí Sending PC update to database:",r),await g(r),t>0){const u=G("penalty_corner",e,{pc_a:e==="a"?i:o.value?.pc_a||0,pc_b:e==="b"?i:o.value?.pc_b||0},o.value?.time_left||0);await N(u)}console.log(`‚úÖ PC updated for team ${e.toUpperCase()}:`,r)}catch(r){console.error(`‚ùå Failed to update PC for team ${e}:`,r),o.value&&(e==="a"?o.value.pc_a=a:o.value.pc_b=a)}delete te.value[l]},300)}async function J(e,t,l){new Date().toISOString();const a=`${t.number}_${t.name.replace(/\s+/g,"_")}`;let i=0;switch(l){case"yellow":i=300*1e3;break;case"green":i=120*1e3;break;case"red":i=0;break}const r={...o.value?.cards||{}},u=`team_${e}`;r[u]||(r[u]={yellow:0,green:0,red:0}),r[u][l]=(r[u][l]||0)+1,r.player_penalties||(r.player_penalties={}),r.player_penalties[u]||(r.player_penalties[u]={});const p={type:l,expires_at:l==="red"?"never":new Date(Date.now()+i).toISOString()};r.player_penalties[u][a]=p,r.player_info||(r.player_info={}),r.player_info[u]||(r.player_info[u]={}),r.player_info[u][a]={name:t.name,number:t.number,position:t.position},await g({cards:r});const _=G("card_issued",e,{card_type:l,player_name:t.name,player_number:t.number,duration:l==="red"?"never":i/1e3},o.value?.time_left||0);await N(_)}async function dt(){if(!f.value.spinners){z("spinners",!0);try{if(console.log("üé∞ Starting booster selection...",{match:o.value?.status}),o.value?.status!=="active"&&o.value?.status!=="pending"){console.log("‚ö†Ô∏è Cannot start booster selection - invalid match status");return}V.value=!0,x.value={teamA:[],teamB:[]},m.value="ready",y.value=null,console.log("üé∞ Updating database with booster selection state...");const e=o.value?.boosters||{};await g({boosters:{...e,selection_active:!0,selection_phase:"ready",is_spinning:!1,current_team:null,spinning_slot:0,current_boosters:{teamA:[],teamB:[]}}}),console.log("‚úÖ Booster selection state updated in database")}catch(e){console.error("‚ùå Failed to start booster selection:",e),alert("Failed to start booster selection. Please try again."),V.value=!1}finally{z("spinners",!1)}}}async function ut(){if(console.log("üé∞ spinCurrentPhase called:",{isSpinning:h.value,availableBoosters:k.value.length,currentPhase:m.value}),h.value){console.log("‚ö†Ô∏è Already spinning, ignoring call");return}if(k.value.length===0){console.log("‚ö†Ô∏è No available boosters, cannot spin");return}if(m.value==="complete"){console.log("‚ö†Ô∏è Selection already complete, cannot spin");return}h.value=!0,se.value=0;try{await _t()}catch(r){console.warn("üîä Failed to play spinning sound:",r)}let e,t;switch(m.value){case"ready":m.value="team-a-first",e="A",t=0;break;case"team-a-first":m.value="team-a-second",e="A",t=1;break;case"team-a-second":m.value="team-b-first",e="B",t=0;break;case"team-b-first":m.value="team-b-second",e="B",t=1;break;case"team-b-second":console.warn("‚ö†Ô∏è team-b-second phase called again - selection should be complete"),m.value="complete",h.value=!1;return;case"complete":console.warn("‚ö†Ô∏è Spin called but selection is already complete"),h.value=!1;return;default:console.error("‚ùå Unknown booster phase:",m.value),h.value=!1;return}console.log("üéØ Phase transition:",{newPhase:m.value,targetTeam:e,boosterIndex:t}),y.value=e;const a=o.value?.boosters||{};g({boosters:{...a,selection_active:!0,selection_phase:m.value,is_spinning:!0,current_team:e,spinning_slot:0}}).then(()=>{console.log("‚úÖ Database updated with spinning state")}).catch(r=>{console.error("‚ùå Failed to update database with spinning state:",r)});const i=setInterval(()=>{const r=Math.floor(Math.random()*k.value.length);se.value=r},100);setTimeout(async()=>{try{console.log("üé∞ Timeout triggered - stopping spin..."),clearInterval(i);const r=[...x.value.teamA,...x.value.teamB].map(_=>_.id),u=k.value.filter(_=>!r.includes(_.id));if(console.log("üé∞ Available boosters for selection:",{total:k.value.length,available:u.length,excluded:r.length,targetTeam:e}),u.length>0){const _=Math.floor(Math.random()*u.length),E=u[_];if(E){se.value=k.value.findIndex(L=>L.id===E.id),e==="A"?x.value.teamA.push(E):x.value.teamB.push(E),console.log("üéØ Booster selected:",{booster:E.name,team:e,teamA_count:x.value.teamA.length,teamB_count:x.value.teamB.length});try{await xt()}catch(L){console.warn("üîä Failed to play selection sound:",L)}}}else console.warn("‚ö†Ô∏è No available boosters for selection!");m.value==="team-b-second"&&(console.log("üéØ All teams finished spinning, setting phase to complete"),m.value="complete",console.log("üéØ Selection complete - user can now confirm boosters manually"));const p=o.value?.boosters||{};try{await g({boosters:{...p,selection_active:!0,selection_phase:m.value,is_spinning:!1,current_team:e,spinning_slot:se.value,current_boosters:{teamA:x.value.teamA,teamB:x.value.teamB}}})}catch(_){console.error("‚ùå Failed to update match after spin:",_)}console.log("üé∞ Updated database after spin completion:",{phase:m.value,teamA:x.value.teamA,teamB:x.value.teamB,teamA_length:x.value.teamA.length,teamB_length:x.value.teamB.length}),h.value=!1,y.value=null,console.log("üéØ Spin completed successfully. Phase:",m.value)}catch(r){console.error("‚ùå Error in spin timeout:",r),h.value=!1,y.value=null}},2e3)}async function mt(){if(console.log("üéØ confirmBoosters() called - starting confirmation process"),!o.value){console.error("‚ùå No match found, cannot confirm boosters");return}const e=o.value.boosters?.current_boosters||{teamA:[],teamB:[]};if(console.log("üéØ Confirming boosters from database...",{raw_boosters:o.value.boosters,currentBoosters:e,teamA:e.teamA,teamB:e.teamB,teamA_length:e.teamA?.length||0,teamB_length:e.teamB?.length||0,path_check:{has_boosters:!!o.value.boosters,has_current_boosters:!!o.value.boosters?.current_boosters,current_boosters_keys:o.value.boosters?.current_boosters?Object.keys(o.value.boosters.current_boosters):[]}}),!e.teamA?.length||!e.teamB?.length){console.error("‚ùå Cannot confirm boosters - missing selections:",{teamA_count:e.teamA?.length||0,teamB_count:e.teamB?.length||0}),alert("Please complete booster selection for both teams before confirming!");return}e.teamA,e.teamB;const t={teamA:e.teamA.map(l=>({...l,available:!0,activated:!1,used:!1})),teamB:e.teamB.map(l=>({...l,available:!0,activated:!1,used:!1})),selection_active:!1,selection_phase:null,is_spinning:!1,current_team:null,spinning_slot:null,current_boosters:null};console.log("üéØ Updating database with final booster data:",{finalBoosterData:t,teamA:t.teamA,teamB:t.teamB,teamA_length:t.teamA?.length,teamB_length:t.teamB?.length}),await g({boosters:t}),console.log("‚úÖ Database updated! Boosters should now be visible on scoreboard"),setTimeout(async()=>{try{const{data:l}=await F.from("matches").select("boosters").eq("id",o.value.id).single();console.log("üîç Verification - boosters in database after 1 second:",{teamA:l?.boosters?.teamA?.length||0,teamB:l?.boosters?.teamB?.length||0,full_boosters:l?.boosters})}catch(l){console.error("‚ùå Failed to verify boosters in database:",l)}},1e3),setTimeout(async()=>{try{const{data:l}=await F.from("matches").select("boosters").eq("id",o.value.id).single();console.log("üîç Verification - boosters in database after 6 seconds:",{teamA:l?.boosters?.teamA?.length||0,teamB:l?.boosters?.teamB?.length||0,full_boosters:l?.boosters}),!l?.boosters?.teamA?.length&&!l?.boosters?.teamB?.length&&console.error("‚ùå CRITICAL: Boosters were cleared from database! This indicates another process is overwriting them.")}catch(l){console.error("‚ùå Failed to verify boosters in database:",l)}},6e3),console.log("üéØ Boosters confirmed and modal closing"),V.value=!1,x.value={teamA:[],teamB:[]},Fe.value=!1}function Ue(){if(console.log("üö´ Canceling booster selection"),V.value=!1,x.value={teamA:[],teamB:[]},h.value=!1,m.value="ready",Fe.value=!1,y.value=null,o.value?.boosters){const e={...o.value.boosters};delete e.selection_active,delete e.selection_phase,delete e.is_spinning,delete e.current_team,delete e.spinning_slot,delete e.current_boosters,g({boosters:e}).catch(console.error)}}function vt(){console.log("üîç Current Booster State:",{isSpinning:h.value,boosterPhase:m.value,currentTeamSpinning:y.value,selectedBoosters:x.value,availableBoosters:k.value.length,matchBoosters:o.value?.boosters,showBoosterSelection:V.value})}function bt(){console.log("üîß Forcing selection completion..."),k.value.length>=4?(x.value={teamA:k.value.slice(0,2),teamB:k.value.slice(2,4)},m.value="complete",h.value=!1,y.value=null,console.log("üîß Selection forced to complete with mock boosters")):console.error("‚ùå Not enough available boosters for mock selection")}async function je(e,t){if(!o.value?.boosters)return;const l={...o.value.boosters},a=e==="a"?"teamA":"teamB";if(l[a]&&l[a][t]&&!l[a][t].activated&&!l[a][t].countdown){const i=[...l[a]],r=i[t];i[t]={...r,countdown:!0,countdownStartedAt:new Date().toISOString()},l[a]=i,console.log(`üïê Starting countdown for team ${e.toUpperCase()} booster:`,{boosterIndex:t,booster:i[t],boosterType:r.id,hasDuration:!!r.duration,allBoosters:l}),await g({boosters:l}),setTimeout(async()=>{try{const u=await F.from("matches").select("boosters").eq("id",o.value?.id).single();if(u.error){console.error("Error checking match state during countdown:",u.error);return}const p=u.data.boosters,_=p?.[a]?.[t];if(!_?.countdown){console.log("üö´ Booster countdown was cancelled or already processed");return}console.log(`üöÄ Countdown complete - activating booster for team ${e.toUpperCase()}`);const E={...p},L=[...E[a]];L[t]={..._,activated:!0,activatedAt:new Date().toISOString(),countdown:!1},E[a]=L,await Ne(r);const X={boosters:E};r.id==="coach_stroke"?(console.log("üéØ Coach stroke activated - pausing match for execution"),X.status="paused",ie(),re()):r.id==="goalie_timeout"&&(console.log("ü•Ö Goalie timeout activated - opposing goalie benched"),X.special_state=`goalie_timeout_${e==="a"?"b":"a"}`),await g(X);const St=G("booster_activated",e,{booster_id:r.id||"",booster_name:r.name||r.title||"Unknown Booster",booster_icon:r.icon||"‚ö°",duration:r.duration},o.value?.time_left||0);await N(St),r.duration&&r.duration>0?(console.log(`‚è∞ Timed booster activated: ${r.name} for ${r.duration} minute(s)`),$e(r,e,t)):console.log(`‚ö° Instant effect booster activated: ${r.name}`)}catch(u){console.error("Error during booster activation after countdown:",u)}},15e3)}}async function Oe(e){if(console.log("üé™ Trigger Maddie called",{selectedMaddie:e,currentState:o.value?.maddie}),e){const t={...e,countdown:!0,countdownStartedAt:new Date().toISOString()};console.log("üïê Starting maddie countdown:",t),await g({maddie:t}),setTimeout(async()=>{try{const l=await F.from("matches").select("maddie").eq("id",o.value?.id).single();if(l.error){console.error("Error checking match state during maddie countdown:",l.error);return}const a=l.data.maddie;if(typeof a!="object"||!a?.countdown){console.log("üö´ Maddie countdown was cancelled or already processed");return}console.log("üöÄ Maddie countdown complete - activating maddie!");const i={...a,activated:!0,activatedAt:new Date().toISOString(),countdown:!1};await Le(),await g({maddie:i});const r=G("maddie_activated",null,{maddie_id:a.id||"",maddie_name:a.name||a.title||"Unknown Maddie",maddie_icon:a.icon||"üé™",duration:a.duration?a.duration/60:void 0},o.value?.time_left||0);await N(r),a.duration&&a.duration>0&&(console.log(`üïê Starting maddie timer for ${a.duration} seconds`),Ct(a),setTimeout(async()=>{try{const u=await F.from("matches").select("maddie").eq("id",o.value?.id).single();if(u.error){console.error("Error checking match state during maddie timer:",u.error);return}const p=u.data.maddie;typeof p=="object"&&p?.activated&&(console.log("üö´ Maddie duration expired - deactivating"),await g({maddie:!1}),pe())}catch(u){console.error("Error during maddie timer expiration:",u)}},a.duration*1e3))}catch(l){console.error("Error during maddie activation after countdown:",l)}},15e3)}else{const t=!o.value?.maddie;t&&await Le(),await g({maddie:t})}}async function gt(){console.log("üö´ Deactivating maddie manually");try{pe(),await g({maddie:!1}),console.log("‚úÖ Maddie deactivated successfully")}catch(e){console.error("Error deactivating maddie:",e)}}async function pt(){const e=ve();await g({time_left:e}),Be()}async function ft(){console.log("üéØ Resuming match after booster execution"),await g({status:"active",special_state:null}),Te(),Se()}async function ze(){if(console.log("üöÄ Initialize match clicked",{match:o.value,status:o.value?.status}),o.value?.status!=="pending"){console.warn("‚ö†Ô∏è Cannot initialize - match status is not pending:",o.value?.status);return}if(Q.value){console.log("‚è≥ Already initializing, ignoring click");return}try{Q.value=!0,console.log("üîß Initializing match..."),console.log("üîÑ Setting initialized to true for immediate UI update"),O.value=!0,await Dt(),console.log("üì§ About to call updateMatch...");const e=o.value?.boosters||{},t=e.teamA?.length>0||e.teamB?.length>0;let l;t?(console.log("üéØ Preserving existing confirmed boosters during initialization"),l={...e,selection_active:!1,selection_phase:null,is_spinning:!1,current_team:null,spinning_slot:null,current_boosters:null}):(console.log("üéØ No existing boosters found, initializing empty booster structure"),l={selection_active:!1,selection_phase:null,is_spinning:!1,current_team:null,spinning_slot:null,current_boosters:null,teamA:[],teamB:[]});const a=await g({status:"pending",score_a:0,score_b:0,pc_a:0,pc_b:0,cards:{},boosters:l,time_left:ve()});console.log("üì• updateMatch completed with result:",a),a&&a.success?(console.log("‚úÖ Match initialized successfully"),o.value={...o.value}):(console.error("‚ùå Database update failed, reverting initialized state"),O.value=!1,alert("Failed to initialize match. Please check the console and try again."))}catch(e){console.error("‚ùå Error initializing match:",e),O.value=!1,alert("Failed to initialize match. Please try again.")}finally{Q.value=!1}}async function ht(){if(!(!o.value||Z.value||!confirm(`Are you sure you want to reset this match?

This will:
‚Ä¢ Clear all scores (0-0)
‚Ä¢ Clear all penalty corners (0-0)
‚Ä¢ Remove all player penalties
‚Ä¢ Clear all boosters
‚Ä¢ Reset timer to 30:00
‚Ä¢ Return to initialization state

This action cannot be undone!`)))try{Z.value=!0;const t=ve();await g({status:"pending",score_a:0,score_b:0,pc_a:0,pc_b:0,cards:{},boosters:{},time_left:t,maddie:!1}),ie(),re(),T.value="quarter",S.value=1,A.value=0,xe.value=0,V.value=!1,x.value={teamA:[],teamB:[]},m.value="ready",y.value=null,h.value=!1,O.value=!1,console.log("‚úÖ Match reset successfully")}catch(t){console.error("‚ùå Error resetting match:",t),alert("Failed to reset match. Please try again.")}finally{Z.value=!1}}async function Ne(e){try{if(!e.sound_file){await U.playSound("/sounds/booster-activate.mp3",.8);return}let t;if(e.sound_file.startsWith("custom_")){const l=U.getCustomSound(e.sound_file);l?t=l:(console.warn("Custom booster sound not found, using default"),t="/sounds/booster-activate.mp3")}else t=`/sounds/boosters/${e.sound_file}`;console.log("üîä Playing booster sound:",t),await U.playSound(t,.8)}catch(t){console.error("üîä Error playing booster sound:",t);try{await U.playSound("/sounds/boosters/booster_1.mp3",.8)}catch(l){console.error("üîä Fallback sound also failed:",l)}}}async function Le(e){try{e?.sound_file;try{await U.playSound("/sounds/maddies/maddie_1.mp3",.8)}catch{await U.playSound("/sounds/maddie.mp3",.8)}console.log("üîä Playing maddie sound")}catch(t){console.error("üîä Error playing maddie sound:",t)}}async function _t(){try{await U.playSound("/sounds/booster_spin.wav",.6),console.log("üîä Playing spinning sound")}catch{console.log("üîä Spinning sound not available, trying fallback");try{await U.playSound("/sounds/boosters/booster_1.mp3",.4)}catch{console.warn("üîä No spinning sound available")}}}async function xt(){try{await U.playSound("/sounds/selection.mp3",1.5),console.log("üîä Playing booster selection sound")}catch{console.log("üîä Selection sound not available, trying fallback");try{await U.playSound("/sounds/boosters/booster_2.mp3",.5)}catch{console.warn("üîä No selection sound available")}}}function $e(e,t,l){const a=`${t}_${l}_${Date.now()}`,i=e.duration*60*1e3,r=Date.now()+i;console.log(`‚è∞ Starting timer for ${e.name}: ${e.duration} minutes`);const u=setInterval(()=>{const p=Date.now(),_=r-p;_<=1e3&&_>0&&!H.value[a]?.oneSecondWarningPlayed&&(console.log(`‚ö†Ô∏è 1 second warning for ${e.name}`),Ne(e),H.value[a]&&(H.value[a].oneSecondWarningPlayed=!0)),_<=0&&(console.log(`‚è∞ Booster ${e.name} expired`),Ge(a),yt(t,l))},100);H.value[a]={booster:e,team:t,endTime:r,intervalId:u,oneSecondWarningPlayed:!1}}function Ge(e){const t=H.value[e];t&&(clearInterval(t.intervalId),delete H.value[e])}async function yt(e,t){if(!o.value?.boosters)return;const l={...o.value.boosters},a=e==="a"?"teamA":"teamB";if(l[a]&&l[a][t]&&l[a][t].activated){const i=[...l[a]];i[t]={...i[t],expired:!0,expiredAt:new Date().toISOString()},l[a]=i,console.log(`üèÅ Booster expired for team ${e.toUpperCase()}:`,{boosterIndex:t,booster:i[t]}),await g({boosters:l})}}async function Ve(e,t){if(!o.value?.boosters)return;const l={...o.value.boosters},a=e==="a"?"teamA":"teamB";if(l[a]&&l[a][t]){const i=l[a][t];if(i.activated&&(!i.duration||i.duration===0)){console.log(`üèÅ Finishing instant booster ${i.name} for team ${e.toUpperCase()}`);const r=[...l[a]];r[t]={...r[t],activated:!1,expired:!0,expiredAt:new Date().toISOString()},l[a]=r;let u={boosters:l};(i.id==="goalie_timeout"||i.id==="timeout"||i.id==="coach_stroke")&&(u.special_state=null,console.log(`üèÅ Cleared special state for instant booster ${i.name}`)),await g(u),console.log(`‚úÖ Instant booster ${i.name} finished successfully`)}else console.warn(`‚ö†Ô∏è Cannot finish booster ${i.name} - either not activated or has duration`)}}let Me=null;function wt(){o.value&&(Me=F.channel(`match_${o.value.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches",filter:`id=eq.${o.value.id}`},e=>{console.log("üîÑ Admin received match update:",e.new),console.log("üèë MATCH CONTROL - Received update for match:",e.new.id),console.log("üèë MATCH CONTROL - Booster update detected:",e.new.boosters),console.log("üèëüîÑ Admin payload details:",{eventType:e.eventType,hasOldBoosters:!!o.value?.boosters,hasNewBoosters:!!e.new.boosters,oldBoosters:o.value?.boosters,newBoosters:e.new.boosters});const t=o.value,l=e.new;t?.boosters&&(!l.boosters||!l.boosters.teamA&&!l.boosters.teamB)&&(console.log("‚ö†Ô∏è Preserving existing boosters - new payload lacks booster data"),l.boosters=t.boosters),o.value=l,t?.boosters&&l.boosters&&(console.log("üîÑ Checking for user booster activations..."),kt(t.boosters,l.boosters)),Be()}).subscribe())}function kt(e,t){if(console.log("üîç Detecting user booster activations:",{oldBoosters:e,newBoosters:t}),!e||!t){console.log("‚ùå Missing booster data for detection");return}e.teamA&&t.teamA&&(console.log(`üîç Checking Team A boosters: ${e.teamA.length} old vs ${t.teamA.length} new`),t.teamA.forEach((l,a)=>{const i=e.teamA[a];console.log(`üîç Team A booster ${a}:`,{oldActivated:i?.activated,newActivated:l.activated,willTrigger:i&&!i.activated&&l.activated,oldBooster:i,newBooster:l}),i&&!i.activated&&l.activated&&(console.log(`üöÄ User activated Team A booster: ${l.name||l.title}`,l),l.duration&&l.duration>0&&$e(l,"a",a))})),e.teamB&&t.teamB&&(console.log(`üîç Checking Team B boosters: ${e.teamB.length} old vs ${t.teamB.length} new`),t.teamB.forEach((l,a)=>{const i=e.teamB[a];console.log(`üîç Team B booster ${a}:`,{oldActivated:i?.activated,newActivated:l.activated,willTrigger:i&&!i.activated&&l.activated,oldBooster:i,newBooster:l}),i&&!i.activated&&l.activated&&(console.log(`üöÄ User activated Team B booster: ${l.name||l.title}`,l),l.duration&&l.duration>0&&$e(l,"b",a))}))}function Ct(e){if(console.log("üïê Starting maddie timer in match control...",{maddie:e,duration:e.duration}),pe(),!e.duration||e.duration<=0){console.log("‚ö†Ô∏è Maddie has no duration, skipping timer");return}const t=Date.now()+e.duration*1e3;D.value={maddie:e,endTime:t,remainingTime:e.duration},console.log(`üïê Started maddie timer: ${e.duration} seconds`);const l=setInterval(()=>{if(D.value){const a=Date.now(),i=Math.max(0,Math.ceil((D.value.endTime-a)/1e3));D.value.remainingTime=i,console.log(`‚è∞ Maddie timer: ${i}s remaining`),i<=0&&(console.log("üö´ Maddie timer expired in match control"),pe())}else clearInterval(l)},1e3);D.value.intervalId=l}function pe(){console.log("üßπ Clearing maddie timer in match control"),D.value?.intervalId&&clearInterval(D.value.intervalId),D.value=null}const Bt=e=>{if(e<=0)return"0:00";const t=Math.floor(e/60),l=e%60;return`${t}:${l.toString().padStart(2,"0")}`};function Tt(){Object.keys(H.value).forEach(e=>{Ge(e)})}return Mt(async()=>{_e.value=!0,f.value={play:!1,pause:!1,finish:!1,spinners:!1},console.log("üîÑ Button states reset on mount");try{await Promise.all([at(),lt(),We()]),wt(),o.value?.status==="active"&&(Te(),Se())}catch(e){console.error("‚ùå CRITICAL: Failed to initialize Match Control:",e),alert("Failed to load match data. Please refresh the page or contact support.")}finally{_e.value=!1,console.log("‚úÖ Match Control initialization complete (loading state cleared)")}}),Pt(()=>{ie(),re(),Tt(),Object.values(ee.value).forEach(e=>{clearTimeout(e)}),Object.values(te.value).forEach(e=>{clearTimeout(e)}),Object.values(W.value).forEach(e=>{clearTimeout(e)}),Me&&Me.unsubscribe()}),(e,t)=>{const l=Et("RouterLink");return d(),c(M,null,[s("div",jt,[s("div",Ot,[_e.value?(d(),c("div",zt,[s("div",Nt,n(e.$t("matchControl.loading")),1)])):o.value?(d(),c("div",Vt,[s("div",Ht,[s("div",null,[s("h1",Qt,n(e.$t("matchControl.title")),1),s("p",Kt,n(I.value?.name||"Team A")+" vs "+n(R.value?.name||"Team B"),1)]),s("div",Yt,[s("button",{onClick:t[0]||(t[0]=a=>ae.value=!0),class:"btn btn-info gap-2"}," üìä Match Stats "),Pe(l,{to:"/admin",class:"btn btn-secondary"},{default:Ee(()=>[B(n(e.$t("matchControl.backToAdmin")),1)]),_:1})])]),o.value.status==="pending"&&!O.value?(d(),c("div",Wt,[s("div",Jt,n(e.$t("matchControl.setup.title")),1),s("div",Xt,n(e.$t("matchControl.setup.description")),1),s("button",{onClick:t[1]||(t[1]=()=>{console.log("üñ±Ô∏è Initialize button clicked!"),ze()}),class:"btn bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold px-8 py-4 text-xl disabled:opacity-50 disabled:cursor-not-allowed",disabled:!o.value||o.value.status!=="pending"||Q.value},[Q.value?(d(),c("span",ea,"‚è≥")):(d(),c("span",ta,"üèë")),B(" "+n(Q.value?"Initializing...":e.$t("matchControl.setup.initializeButton"))+" ",1),o.value?.status!=="pending"?(d(),c("span",aa," (Status: "+n(o.value?.status||"loading...")+") ",1)):v("",!0)],8,Zt)])):(d(),c("div",sa,[s("div",oa,[s("h2",la,n(I.value?.name||"Team A"),1),s("div",na,[s("div",ia,n(o.value.score_a),1),s("div",ra,[s("button",{onClick:t[2]||(t[2]=a=>be("a",-1)),class:"btn btn-danger"},"-1"),s("button",{onClick:t[3]||(t[3]=a=>be("a",1)),class:"btn btn-success"},"+1")])]),s("div",ca,[t[21]||(t[21]=s("div",{class:"text-lg font-semibold text-white mb-2"},"Penalty Corners",-1)),s("div",da,n(o.value.pc_a||0),1),s("div",ua,[s("button",{onClick:t[4]||(t[4]=a=>ge("a",-1)),class:"btn btn-sm btn-warning"},"-1"),s("button",{onClick:t[5]||(t[5]=a=>ge("a",1)),class:"btn btn-sm btn-warning"},"+1")])]),s("div",ma,[s("h3",va,n(e.$t("matchControl.penalties.title")),1),me("a").length>0?(d(),c("div",ba,[(d(!0),c(M,null,q(me("a"),a=>(d(),c("div",{key:a.playerId,class:w(["text-xs px-3 py-2 rounded-lg text-center font-bold",{"bg-yellow-500 text-black":a.type==="yellow","bg-green-600 text-white":a.type==="green","bg-red-600 text-white":a.type==="red"}])},[B(" #"+n(a.playerNumber)+" "+n(a.playerName),1),t[22]||(t[22]=s("br",null,null,-1)),B(" "+n(a.type.toUpperCase())+" - "+n(a.timeRemaining),1)],2))),128))])):(d(),c("div",ga,n(e.$t("matchControl.penalties.noPenalties")),1)),s("div",pa,n(e.$t("matchControl.penalties.total"))+": "+n(e.$t("matchControl.penalties.yellow"))+":"+n(o.value.cards?.team_a?.yellow||0)+" "+n(e.$t("matchControl.penalties.green"))+":"+n(o.value.cards?.team_a?.green||0)+" "+n(e.$t("matchControl.penalties.red"))+":"+n(o.value.cards?.team_a?.red||0),1)]),o.value.boosters?.teamA?.filter(a=>!a.expired)?.length>0?(d(),c("div",fa,[s("h3",ha,n(e.$t("matchControl.boosters.title")),1),s("div",_a,[(d(!0),c(M,null,q(o.value.boosters.teamA,(a,i)=>fe((d(),c("div",{key:`team-a-booster-${i}`,class:w(["bg-blue-600/20 rounded-lg p-3 border border-blue-400/40 shadow-lg transition-all duration-300",a.activated?"ring-2 ring-green-400 bg-green-600/20":""])},[s("div",xa,[s("div",ya,[s("div",wa,[s("span",ka,n(a.icon),1),s("span",null,n(a.name),1),a.activated&&!a.expired?(d(),c("span",Ca,n(e.$t("matchControl.boosters.active")),1)):a.activated?v("",!0):(d(),c("span",Ba,n(e.$t("matchControl.boosters.ready")),1))]),s("div",Ta,n(a.description),1)]),!a.activated&&!a.expired&&(o.value.status==="active"||o.value.status==="pending")?(d(),c("button",{key:0,onClick:r=>je("a",i),class:"btn-xs bg-green-600 hover:bg-green-700 text-white ml-2 animate-pulse"},n(e.$t("matchControl.boosters.activate")),9,Sa)):a.activated&&!a.expired&&(!a.duration||a.duration===0)?(d(),c("button",{key:1,onClick:r=>Ve("a",i),class:"btn-xs bg-orange-600 hover:bg-orange-700 text-white ml-2",title:"Finish instant booster"}," Finish ",8,Aa)):a.activated&&!a.expired?(d(),c("span",$a,n(e.$t("matchControl.boosters.live")),1)):v("",!0)])],2)),[[Ke,!a.expired]])),128))])])):v("",!0),s("div",null,[t[23]||(t[23]=s("h3",{class:"text-lg font-semibold text-white mb-3"},"Players",-1)),s("div",Ma,[(d(!0),c(M,null,q(I.value?.players||[],a=>(d(),c("div",{key:a.name,class:"bg-white/5 rounded p-3"},[s("div",Pa,[s("div",null,[s("span",Ea,n(a.name)+" (#"+n(a.number)+")",1),s("div",qa,n(a.position),1)])]),$("a",a)?(d(),c("div",Fa,[s("div",{class:w(["text-xs px-2 py-1 rounded text-center font-bold",{"bg-yellow-500 text-black":$("a",a)?.type==="yellow","bg-green-500 text-white":$("a",a)?.type==="green","bg-red-500 text-white":$("a",a)?.type==="red"}])},n($("a",a)?.type.toUpperCase())+" CARD - "+n(we($("a",a)?.time_remaining||0)),3)])):v("",!0),s("div",Da,[s("button",{onClick:i=>J("a",a,"yellow"),class:"btn-xs bg-yellow-500 hover:bg-yellow-600 text-black text-xs"}," Y ",8,Ia),s("button",{onClick:i=>J("a",a,"green"),class:"btn-xs bg-green-500 hover:bg-green-600 text-white text-xs"}," G ",8,Ra),s("button",{onClick:i=>J("a",a,"red"),class:"btn-xs bg-red-500 hover:bg-red-600 text-white text-xs"}," R ",8,Ua)])]))),128))])])]),s("div",ja,[t[28]||(t[28]=s("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Match Control",-1)),s("div",Oa,[s("div",za,[s("div",Na,n(Ze.value),1),T.value!=="finished"?(d(),c("div",La,n(ke(A.value))+" remaining ",1)):v("",!0)]),s("div",Ga,n(ke(o.value.time_left)),1),t[24]||(t[24]=s("div",{class:"text-sm text-white/60 mb-4"}," Total Match Time ",-1)),s("div",{class:w(["px-4 py-2 rounded-full text-white font-bold text-xl inline-block",{"bg-green-500":o.value.status==="active","bg-yellow-500":o.value.status==="paused","bg-red-500":o.value.status==="finished","bg-gray-500":o.value.status==="pending"}])},n(o.value.status.toUpperCase()),3)]),s("div",Va,[o.value.status!=="active"?(d(),c("button",{key:0,onClick:rt,disabled:f.value.play,class:w(["btn btn-success",{"opacity-50 cursor-not-allowed":f.value.play}])},[f.value.play?(d(),c("span",Qa,"‚è≥")):(d(),c("span",Ka,"‚ñ∂Ô∏è")),B(" "+n(f.value.play?"Starting...":"Play"),1)],10,Ha)):(d(),c("button",{key:1,onClick:ct,disabled:f.value.pause,class:w(["btn btn-warning",{"opacity-50 cursor-not-allowed":f.value.pause}])},[f.value.pause?(d(),c("span",Wa,"‚è≥")):(d(),c("span",Ja,"‚è∏Ô∏è")),B(" "+n(f.value.pause?"Pausing...":"Pause"),1)],10,Ya)),o.value.status==="paused"&&o.value.special_state?(d(),c("button",{key:2,onClick:ft,class:"btn bg-green-600 hover:bg-green-700 animate-pulse"}," ‚ñ∂Ô∏è Resume After Booster ")):v("",!0),s("button",{onClick:Ae,disabled:f.value.finish,class:w(["btn btn-danger",{"opacity-50 cursor-not-allowed":f.value.finish}])},[f.value.finish?(d(),c("span",Za,"‚è≥")):(d(),c("span",es,"‚èπÔ∏è")),B(" "+n(f.value.finish?"Finishing...":"Finish"),1)],10,Xa),s("button",{onClick:pt,class:"btn btn-secondary col-span-2"}," üîÑ Reset Timer (30:00) "),o.value.status==="pending"&&!O.value?(d(),c("button",{key:3,onClick:ze,class:"btn btn-primary col-span-2"}," üöÄ Initialize Match ")):v("",!0),(o.value.status==="active"||o.value.status==="pending")&&!o.value.boosters?.teamA?.length&&!o.value.boosters?.teamB?.length?(d(),c("button",{key:4,onClick:dt,disabled:f.value.spinners,class:w(["btn bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 col-span-2 animate-pulse",{"opacity-50 cursor-not-allowed":f.value.spinners}])},[f.value.spinners?(d(),c("span",as,"‚è≥")):(d(),c("span",ss,"üé∞")),B(" "+n(f.value.spinners?"Starting Casino...":"Spin Casino Boosters"),1)],10,ts)):o.value.boosters?.teamA?.length>0||o.value.boosters?.teamB?.length>0?(d(),c("div",os," ‚úÖ Boosters already assigned ")):v("",!0)]),s("div",ls,[s("div",null,[t[27]||(t[27]=s("h3",{class:"text-lg font-semibold text-white mb-3"},"Special Effects",-1)),o.value.maddie?(d(),c("div",ns,[s("div",is,[s("div",rs,n(typeof o.value.maddie=="object"&&o.value.maddie.icon||"üé™"),1),s("div",cs,n(typeof o.value.maddie=="object"?o.value.maddie.name||o.value.maddie.title||"Special Effect":"MADDIE ACTIVE!"),1),typeof o.value.maddie=="object"&&o.value.maddie.countdown?(d(),c("div",ds," üïê Countdown Active ")):typeof o.value.maddie=="object"&&o.value.maddie.activated?(d(),c("div",us," ‚ú® ACTIVE ")):v("",!0),s("button",{onClick:t[6]||(t[6]=a=>gt()),class:"mt-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg transition-colors"}," ‚ùå Deactivate Maddie ")])])):v("",!0),o.value.maddie&&D.value&&typeof o.value.maddie=="object"&&o.value.maddie.activated?(d(),c("div",ms,[s("div",vs,[s("div",bs," ‚è±Ô∏è "+n(Bt(D.value.remainingTime)),1),t[25]||(t[25]=s("div",{class:"text-xs text-orange-200"}," Maddie Time Remaining ",-1))])])):v("",!0),o.value.maddie?v("",!0):(d(),c("div",gs,[t[26]||(t[26]=s("h4",{class:"text-sm font-semibold text-gray-300"},"Select Maddie Effect:",-1)),s("div",ps,[(d(!0),c(M,null,q(De.value,a=>(d(),c("button",{key:a.id,onClick:i=>Oe(a),class:"flex items-center justify-center space-x-2 p-3 bg-purple-600/50 hover:bg-purple-600/70 rounded-lg border border-purple-400/50 hover:border-purple-400 transition-all"},[s("span",hs,n(a.icon||"üé™"),1),s("span",_s,n(a.title||a.name),1)],8,fs))),128))]),s("button",{onClick:t[7]||(t[7]=a=>Oe()),class:"w-full btn btn-primary text-sm"}," üé™ Classic Maddie Effect ")])),o.value.maddie?(d(),c("button",{key:3,onClick:t[8]||(t[8]=a=>g({maddie:!1})),class:"w-full btn bg-gray-600 hover:bg-gray-700 text-white text-sm"}," üîÑ Reset Maddie ")):v("",!0)])])]),s("div",xs,[s("h2",ys,n(R.value?.name||"Team B"),1),s("div",ws,[s("div",ks,n(o.value.score_b),1),s("div",Cs,[s("button",{onClick:t[9]||(t[9]=a=>be("b",-1)),class:"btn btn-danger"},"-1"),s("button",{onClick:t[10]||(t[10]=a=>be("b",1)),class:"btn btn-success"},"+1")])]),s("div",Bs,[t[29]||(t[29]=s("div",{class:"text-lg font-semibold text-white mb-2"},"Penalty Corners",-1)),s("div",Ts,n(o.value.pc_b||0),1),s("div",Ss,[s("button",{onClick:t[11]||(t[11]=a=>ge("b",-1)),class:"btn btn-sm btn-warning"},"-1"),s("button",{onClick:t[12]||(t[12]=a=>ge("b",1)),class:"btn btn-sm btn-warning"},"+1")])]),s("div",As,[t[31]||(t[31]=s("h3",{class:"text-lg font-semibold text-white mb-3"},"Active Penalties",-1)),me("b").length>0?(d(),c("div",$s,[(d(!0),c(M,null,q(me("b"),a=>(d(),c("div",{key:a.playerId,class:w(["text-xs px-3 py-2 rounded-lg text-center font-bold",{"bg-yellow-500 text-black":a.type==="yellow","bg-green-600 text-white":a.type==="green","bg-red-600 text-white":a.type==="red"}])},[B(" #"+n(a.playerNumber)+" "+n(a.playerName),1),t[30]||(t[30]=s("br",null,null,-1)),B(" "+n(a.type.toUpperCase())+" - "+n(a.timeRemaining),1)],2))),128))])):(d(),c("div",Ms," No active penalties ")),s("div",Ps," Total: Y:"+n(o.value.cards?.team_b?.yellow||0)+" G:"+n(o.value.cards?.team_b?.green||0)+" R:"+n(o.value.cards?.team_b?.red||0),1)]),o.value.boosters?.teamB?.filter(a=>!a.expired)?.length>0?(d(),c("div",Es,[t[32]||(t[32]=s("h3",{class:"text-lg font-semibold text-white mb-3"},"üéØ Active Boosters",-1)),s("div",qs,[(d(!0),c(M,null,q(o.value.boosters.teamB,(a,i)=>fe((d(),c("div",{key:`team-b-booster-${i}`,class:w(["bg-red-600/20 rounded-lg p-3 border border-red-400/40 shadow-lg transition-all duration-300",a.activated?"ring-2 ring-green-400 bg-green-600/20":""])},[s("div",Fs,[s("div",Ds,[s("div",Is,[s("span",Rs,n(a.icon),1),s("span",null,n(a.name),1),a.activated&&!a.expired?(d(),c("span",Us,"ACTIVE")):a.activated?v("",!0):(d(),c("span",js,"READY"))]),s("div",Os,n(a.description),1)]),!a.activated&&!a.expired&&(o.value.status==="active"||o.value.status==="pending")?(d(),c("button",{key:0,onClick:r=>je("b",i),class:"btn-xs bg-green-600 hover:bg-green-700 text-white ml-2 animate-pulse"}," Activate ",8,zs)):a.activated&&!a.expired&&(!a.duration||a.duration===0)?(d(),c("button",{key:1,onClick:r=>Ve("b",i),class:"btn-xs bg-orange-600 hover:bg-orange-700 text-white ml-2",title:"Finish instant booster"}," Finish ",8,Ns)):a.activated&&!a.expired?(d(),c("span",Ls,"üü¢ LIVE")):v("",!0)])],2)),[[Ke,!a.expired]])),128))])])):v("",!0),s("div",null,[t[33]||(t[33]=s("h3",{class:"text-lg font-semibold text-white mb-3"},"Players",-1)),s("div",Gs,[(d(!0),c(M,null,q(R.value?.players||[],a=>(d(),c("div",{key:a.name,class:"bg-white/5 rounded p-3"},[s("div",Vs,[s("div",null,[s("span",Hs,n(a.name)+" (#"+n(a.number)+")",1),s("div",Qs,n(a.position),1)])]),$("b",a)?(d(),c("div",Ks,[s("div",{class:w(["text-xs px-2 py-1 rounded text-center font-bold",{"bg-yellow-500 text-black":$("b",a)?.type==="yellow","bg-green-500 text-white":$("b",a)?.type==="green","bg-red-500 text-white":$("b",a)?.type==="red"}])},n($("b",a)?.type.toUpperCase())+" CARD - "+n(we($("b",a)?.time_remaining||0)),3)])):v("",!0),s("div",Ys,[s("button",{onClick:i=>J("b",a,"yellow"),class:"btn-xs bg-yellow-500 hover:bg-yellow-600 text-black text-xs"}," Y ",8,Ws),s("button",{onClick:i=>J("b",a,"green"),class:"btn-xs bg-green-500 hover:bg-green-600 text-white text-xs"}," G ",8,Js),s("button",{onClick:i=>J("b",a,"red"),class:"btn-xs bg-red-500 hover:bg-red-600 text-white text-xs"}," R ",8,Xs)])]))),128))])])])])),s("div",Zs,[s("div",eo,[Pe(l,{to:`/scoreboard/${o.value.id}`,target:"_blank",class:"btn btn-primary"},{default:Ee(()=>[...t[34]||(t[34]=[B(" üì∫ Open Scoreboard ",-1)])]),_:1},8,["to"]),s("button",{onClick:t[13]||(t[13]=a=>ae.value=!0),class:"btn btn-secondary"}," üìä Match Stats "),o.value.status!=="pending"?(d(),c("button",{key:0,onClick:ht,disabled:Z.value,class:"btn bg-orange-600 hover:bg-orange-700 text-white border-orange-600 hover:border-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Reset match to initialization state"},n(Z.value?"üîÑ Resetting...":"üîÑ Reset Match"),9,to)):v("",!0)])])])):(d(),c("div",Lt,[s("div",Gt,n(e.$t("matchControl.notFound.title")),1),Pe(l,{to:"/admin",class:"btn btn-primary"},{default:Ee(()=>[B(n(e.$t("matchControl.notFound.backButton")),1)]),_:1})]))]),V.value?(d(),c("div",{key:0,class:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:Ue},[s("div",{class:"bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 rounded-2xl p-6 max-w-5xl w-full border-2 border-purple-500/50 max-h-[90vh] overflow-y-auto",onClick:t[16]||(t[16]=He(()=>{},["stop"]))},[t[38]||(t[38]=s("div",{class:"text-center mb-6"},[s("h2",{class:"text-3xl lg:text-4xl font-bold text-white mb-2"},"üé∞ Casino Booster Selection"),s("p",{class:"text-purple-200"},"Spin the slots to get 2 random boosters for each team!")],-1)),s("div",ao,[s("div",so,n(et()),1),s("div",oo," Phase: "+n(m.value)+" | Spinning: "+n(h.value)+" | Available: "+n(k.value.length),1)]),s("div",lo,[s("div",{class:w(["bg-white/10 rounded-xl p-4 lg:p-6 text-center border-2",{"border-blue-500 shadow-blue-500/50 shadow-lg":y.value==="A"||m.value.includes("team-a")&&!h.value,"border-blue-500/30":y.value!=="A"&&!m.value.includes("team-a")}])},[s("h3",no,n(I.value?.name||"Team A"),1),y.value==="A"||m.value.includes("team-a")&&m.value!=="ready"?(d(),c("div",io,[s("div",{class:w(["text-4xl lg:text-6xl transition-all duration-100",{"animate-spin":h.value&&y.value==="A"}])},n(Re()),3)])):v("",!0),x.value.teamA.length>0?(d(),c("div",ro,[t[35]||(t[35]=s("div",{class:"text-sm font-bold text-blue-300 mb-2"},"Selected Boosters:",-1)),(d(!0),c(M,null,q(x.value.teamA,(a,i)=>(d(),c("div",{key:i,class:"bg-blue-500/20 rounded-lg p-3"},[s("div",co,n(a.icon)+" "+n(a.name),1),s("div",uo,n(a.description),1)]))),128))])):v("",!0)],2),s("div",{class:w(["bg-white/10 rounded-xl p-4 lg:p-6 text-center border-2",{"border-red-500 shadow-red-500/50 shadow-lg":y.value==="B"||m.value.includes("team-b")&&!h.value,"border-red-500/30":y.value!=="B"&&!m.value.includes("team-b")}])},[s("h3",mo,n(R.value?.name||"Team B"),1),y.value==="B"||m.value.includes("team-b")&&m.value!=="ready"?(d(),c("div",vo,[s("div",{class:w(["text-4xl lg:text-6xl transition-all duration-100",{"animate-spin":h.value&&y.value==="B"}])},n(Re()),3)])):v("",!0),x.value.teamB.length>0?(d(),c("div",bo,[t[36]||(t[36]=s("div",{class:"text-sm font-bold text-red-300 mb-2"},"Selected Boosters:",-1)),(d(!0),c(M,null,q(x.value.teamB,(a,i)=>(d(),c("div",{key:i,class:"bg-red-500/20 rounded-lg p-3"},[s("div",go,n(a.icon)+" "+n(a.name),1),s("div",po,n(a.description),1)]))),128))])):v("",!0)],2)]),s("div",fo,[t[37]||(t[37]=s("h3",{class:"text-lg lg:text-xl font-bold text-white mb-4 text-center"},"Available Boosters",-1)),s("div",ho,[(d(!0),c(M,null,q(k.value,a=>(d(),c("div",{key:a.id,class:"bg-white/5 rounded-lg p-2 lg:p-3 text-center border border-purple-500/30"},[s("div",_o,n(a.icon),1),s("div",xo,n(a.name),1),s("div",yo,n(a.description),1)]))),128))])]),s("div",wo,[s("button",{onClick:Ue,class:"btn btn-secondary"}," ‚ùå Cancel "),h.value?(d(),c("button",{key:0,onClick:t[14]||(t[14]=a=>{h.value=!1,y.value=null}),class:"btn bg-orange-600 hover:bg-orange-700 text-white",title:"Debug: Force reset spinning state"}," üîß Reset Spin ")):v("",!0),s("button",{onClick:vt,class:"btn bg-gray-600 hover:bg-gray-700 text-white text-sm",title:"Debug: Log current state to console"}," üîç Debug "),m.value!=="complete"?(d(),c("button",{key:1,onClick:bt,class:"btn bg-yellow-600 hover:bg-yellow-700 text-white text-sm",title:"Debug: Force complete selection with mock boosters"}," ‚ö° Force Complete ")):v("",!0),m.value!=="complete"?(d(),c("button",{key:2,onClick:t[15]||(t[15]=()=>{h.value||ut()}),disabled:h.value,class:w(["btn bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold px-6 lg:px-8",{"opacity-50 cursor-not-allowed":h.value}])},n(h.value?"üé∞ Spinning...":tt()),11,ko)):(d(),c("button",{key:3,onClick:mt,class:"btn btn-success px-6 lg:px-8"}," ‚úÖ Confirm Boosters "))])])])):v("",!0)]),ae.value?(d(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:t[20]||(t[20]=He(a=>ae.value=!1,["self"]))},[s("div",Co,[s("div",Bo,[t[39]||(t[39]=s("h2",{class:"text-3xl font-bold text-white flex items-center gap-3"}," üìä Match Statistics ",-1)),s("button",{onClick:t[17]||(t[17]=a=>ae.value=!1),class:"btn btn-circle btn-sm"},"‚úï")]),s("div",To,[s("div",So,[le.value?(d(),c("div",Ao,[s("h3",$o,n(I.value?.name||"Team A"),1),s("div",Mo,[s("div",Po,[s("div",Eo,n(le.value.goals),1),t[40]||(t[40]=s("div",{class:"text-sm text-blue-200 mt-1"},"Goals",-1))]),s("div",qo,[s("div",Fo,n(le.value.penaltyCorners),1),t[41]||(t[41]=s("div",{class:"text-sm text-purple-200 mt-1"},"Penalty Corners",-1))]),s("div",Do,[s("div",Io,n(le.value.boosters),1),t[42]||(t[42]=s("div",{class:"text-sm text-green-200 mt-1"},"Boosters",-1))]),s("div",Ro,[s("div",Uo,n(le.value.yellowCards),1),t[43]||(t[43]=s("div",{class:"text-sm text-yellow-200 mt-1"},"Yellow Cards",-1))])])])):v("",!0),ne.value?(d(),c("div",jo,[s("h3",Oo,n(R.value?.name||"Team B"),1),s("div",zo,[s("div",No,[s("div",Lo,n(ne.value.goals),1),t[44]||(t[44]=s("div",{class:"text-sm text-purple-200 mt-1"},"Goals",-1))]),s("div",Go,[s("div",Vo,n(ne.value.penaltyCorners),1),t[45]||(t[45]=s("div",{class:"text-sm text-blue-200 mt-1"},"Penalty Corners",-1))]),s("div",Ho,[s("div",Qo,n(ne.value.boosters),1),t[46]||(t[46]=s("div",{class:"text-sm text-green-200 mt-1"},"Boosters",-1))]),s("div",Ko,[s("div",Yo,n(ne.value.yellowCards),1),t[47]||(t[47]=s("div",{class:"text-sm text-yellow-200 mt-1"},"Yellow Cards",-1))])])])):v("",!0)]),s("div",Wo,[s("div",Jo,[t[49]||(t[49]=s("label",{class:"text-sm text-slate-300 mb-2 block"},"Event Type",-1)),fe(s("select",{"onUpdate:modelValue":t[18]||(t[18]=a=>de.value=a),class:"select select-bordered w-full bg-slate-900/80 text-white"},[...t[48]||(t[48]=[qt('<option value="all" data-v-1889642a>All Events</option><option value="goal" data-v-1889642a>‚öΩ Goals</option><option value="penalty_corner" data-v-1889642a>üèë Penalty Corners</option><option value="booster_activated" data-v-1889642a>‚ö° Boosters</option><option value="maddie_activated" data-v-1889642a>üé∞ Maddies</option><option value="card_issued" data-v-1889642a>üü® Cards</option><option value="match_started" data-v-1889642a>‚ñ∂Ô∏è Match Started</option><option value="match_paused" data-v-1889642a>‚è∏Ô∏è Match Paused</option><option value="match_resumed" data-v-1889642a>‚ñ∂Ô∏è Match Resumed</option><option value="match_finished" data-v-1889642a>üèÅ Match Finished</option>',10)])],512),[[Qe,de.value]])]),s("div",Xo,[t[51]||(t[51]=s("label",{class:"text-sm text-slate-300 mb-2 block"},"Team",-1)),fe(s("select",{"onUpdate:modelValue":t[19]||(t[19]=a=>ue.value=a),class:"select select-bordered w-full bg-slate-900/80 text-white"},[t[50]||(t[50]=s("option",{value:"all"},"All Teams",-1)),s("option",Zo,n(I.value?.name||"Team A"),1),s("option",el,n(R.value?.name||"Team B"),1)],512),[[Qe,ue.value]])])]),s("div",tl,[s("h3",al,[t[52]||(t[52]=B(" üìã Event Timeline ",-1)),s("span",sl,"("+n(Ce.value.length)+" events)",1)]),Ce.value.length===0?(d(),c("div",ol," No events found ")):(d(),c("div",ll,[(d(!0),c(M,null,q(Ce.value,(a,i)=>(d(),c("div",{key:i,class:w(["flex items-start gap-4 p-3 rounded-lg border transition-colors",{"bg-blue-900/30 border-blue-500/30":a.team==="a","bg-purple-900/30 border-purple-500/30":a.team==="b","bg-slate-900/30 border-slate-500/30":!a.team}])},[s("div",nl,n(a.type==="goal"?"‚öΩ":a.type==="penalty_corner"?"üèë":a.type==="booster_activated"?"‚ö°":a.type==="maddie_activated"?"üé∞":a.type==="card_issued"?"üü®":a.type==="match_started"?"‚ñ∂Ô∏è":a.type==="match_paused"?"‚è∏Ô∏è":a.type==="match_resumed"?"‚ñ∂Ô∏è":"üèÅ"),1),s("div",il,[s("div",rl,n(a.type==="goal"?"Goal Scored":a.type==="penalty_corner"?"Penalty Corner":a.type==="booster_activated"?"Booster Activated":a.type==="maddie_activated"?"Maddie Activated":a.type==="card_issued"?`${a.details.card_type.toUpperCase()} Card Issued`:a.type==="match_started"?"Match Started":a.type==="match_paused"?"Match Paused":a.type==="match_resumed"?"Match Resumed":"Match Finished"),1),s("div",cl,[a.team==="a"?(d(),c("span",dl,n(I.value?.name),1)):a.team==="b"?(d(),c("span",ul,n(R.value?.name),1)):v("",!0),a.matchTime!==void 0?(d(),c("span",ml," ‚Ä¢ Time: "+n(ke(a.matchTime)),1)):v("",!0)]),a.type==="goal"?(d(),c("div",vl,[B(" Score: "+n(a.details.score_a)+" - "+n(a.details.score_b)+" ",1),a.details.pc?(d(),c("span",bl," (from PC)")):v("",!0)])):a.type==="penalty_corner"?(d(),c("div",gl," PC Count: "+n(a.details.pc_a)+" - "+n(a.details.pc_b),1)):a.type==="booster_activated"?(d(),c("div",pl,n(a.details.booster_name),1)):a.type==="maddie_activated"?(d(),c("div",fl,n(a.details.maddie_name),1)):a.type==="card_issued"?(d(),c("div",hl," Player: "+n(a.details.player_name)+" (#"+n(a.details.player_number)+") ",1)):v("",!0)]),s("div",_l,n(new Date(a.timestamp).toLocaleTimeString()),1)],2))),128))]))])])])])):v("",!0)],64)}}}),Tl=It(xl,[["__scopeId","data-v-1889642a"]]);export{Tl as default};
